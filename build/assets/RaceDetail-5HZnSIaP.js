import{c as U,j as e,S as B,B as i,C as j,a as p,b as g,e as f,T as Y}from"./index-Bg84Z9Mq.js";import{r}from"./react-vendor-CoRTCUxX.js";import{B as _}from"./badge-tBdtZtNR.js";import{H as T,F as R}from"./Footer-CVy8QyIC.js";import{A as ee,S as F}from"./separator-BdqQHWvD.js";import{f as se,D as te,a as ae}from"./dialog-ntEtmWdW.js";import{A,a as E,b as I}from"./avatar-UaX-2Fdw.js";import{b as re,u as ie}from"./router-vendor-BLkE0Fw5.js";import{M as ne}from"./map-pin-Dfm_KS63.js";import{C as le}from"./calendar-Dq3vT5nZ.js";import{U as ce}from"./users-DJ4bN222.js";import{S as de}from"./search-CWcOzX2y.js";import{S as oe}from"./server-DigNV8_e.js";import{E as me}from"./eye-Df-DD7Pk.js";import"./user-DIh3-zlu.js";import"./index-BsVOCjjE.js";import"./index-BIcMawkr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=U("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=U("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=U("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),z=(l,o)=>{if(!l)return"-";try{return new Date(l+(o?`T${o}`:"")).toLocaleString("pt-BR")}catch{return l}},je=l=>{const[o,s]=r.useState(Date.now());return r.useEffect(()=>{const h=setInterval(()=>s(Date.now()),1e3);return()=>clearInterval(h)},[]),r.useMemo(()=>{if(!l)return null;const m=new Date(l).getTime()-o;if(m<=0)return{finished:!0,text:"Iniciada"};const N=Math.floor(m/(1e3*60*60*24)),v=Math.floor(m%(1e3*60*60*24)/(1e3*60*60)),b=Math.floor(m%(1e3*60*60)/(1e3*60)),y=Math.floor(m%(1e3*60)/1e3);return{finished:!1,text:`${N}d ${v}h ${b}m ${y}s`}},[l,o])},Ie=()=>{const{id:l}=re(),o=ie(),[s,h]=r.useState(null),[m,N]=r.useState(!0),[v,b]=r.useState(!1),[y,M]=r.useState(!1),[k,$]=r.useState("grid"),[w,H]=r.useState(""),[u,G]=r.useState("position"),[n,S]=r.useState(null),[pe,K]=r.useState(!1),[q,J]=r.useState(!0);r.useEffect(()=>{l&&(N(!0),fetch(`/api/races/${l}/enriched`).then(t=>t.json()).then(t=>h(t)).catch(t=>console.error(t)).finally(()=>N(!1)))},[l]),r.useEffect(()=>{s&&fetch("/api/session").then(t=>t.json()).then(t=>{t.user&&b(s.participants.some(a=>a.username===t.user.username))}).catch(()=>{})},[s]);const P=r.useMemo(()=>{if(!s)return[];let t=[...s.participants];if(w){const a=w.toLowerCase();t=t.filter(c=>c.displayName.toLowerCase().includes(a)||c.username.toLowerCase().includes(a)||(c.team||"").toLowerCase().includes(a))}return u==="name"&&t.sort((a,c)=>a.displayName.localeCompare(c.displayName)),u==="points"&&t.sort((a,c)=>(c.stats.points||0)-(a.stats.points||0)),t},[s,w,u]),W=s&&s.date?s.time?`${s.date}T${s.time}`:s.date:void 0,O=je(W),X=async()=>{if(s){M(!0);try{const a=await(await fetch(`/api/races/${s.id}/register`,{method:"POST",credentials:"include"})).json();if(a.ok){const c=await fetch(`/api/races/${s.id}/enriched`).then(C=>C.json());h(c),b(!0)}else alert(a.message||"Erro")}catch(t){console.error(t),alert("Erro")}M(!1)}},V=()=>{if(!s)return;const t=[["Pos","Username","DisplayName","Team","Wins","Podiums","Points","RegisteredAt"]];s.participants.forEach((d,D)=>t.push([String(D+1),d.username,d.displayName,d.team||"",String(d.stats.wins||0),String(d.stats.podiums||0),String(d.stats.points||0),d.registeredAt]));const a=t.map(d=>d.map(D=>`"${String(D).replace(/"/g,'""')}"`).join(",")).join(`
`),c=new Blob([a],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(c),L=document.createElement("a");L.href=C,L.download=`race-${s.id}-participants.csv`,L.click(),URL.revokeObjectURL(C)},Z=async()=>{try{navigator.share?await navigator.share({title:(s==null?void 0:s.title)||"Corrida",text:"Confira esta corrida",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),alert("Link copiado"))}catch(t){console.error(t)}},Q=async()=>{if(s)try{const a=await(await fetch("/api/test/configure-udp-for-race",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({raceId:s.id})})).json();a.ok?(K(!0),alert("UDP iniciado: "+(a.udpPort||"ok"))):alert("Falha ao iniciar UDP")}catch(t){console.error(t),alert("Erro")}},x=t=>t==null?"-":String(t);return m?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(T,{}),e.jsxs("div",{className:"container py-8",children:[e.jsx(B,{className:"h-12 w-full mb-4"}),e.jsx(B,{className:"h-64 w-full"})]}),e.jsx(R,{})]}):s?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(T,{}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"h-64 lg:h-96 w-full bg-gradient-to-r from-black/40 via-transparent to-black/30 relative overflow-hidden",children:[s.image?e.jsx("img",{src:s.image,alt:s.title,className:"absolute inset-0 w-full h-full object-cover opacity-90"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-800 to-gray-700"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),e.jsx("div",{className:"container relative z-10 py-8 lg:py-16 flex items-end",children:e.jsxs("div",{className:"w-full text-white",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl lg:text-5xl font-extrabold leading-tight",children:s.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-3 text-sm opacity-90",children:[e.jsx(ne,{className:"h-4 w-4"})," ",e.jsx("span",{children:s.track}),e.jsx(le,{className:"h-4 w-4"})," ",e.jsx("span",{children:z(s.date,s.time)}),e.jsx(_,{className:`ml-2 ${s.status==="live"?"bg-red-600":s.status==="completed"?"bg-green-600":"bg-primary"}`,children:s.status==="live"?"AO VIVO":s.status==="completed"?"FINALIZADA":"PRÃ“XIMA"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"ghost",onClick:Z,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Compartilhar"]}),e.jsxs(i,{variant:"secondary",onClick:V,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]}),e.jsx(i,{onClick:()=>window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),children:"Ver Detalhes"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-3xl",children:s.description}),e.jsxs("div",{className:"mt-4 flex items-center gap-4",children:[e.jsxs("div",{className:"p-3 bg-black/30 rounded text-xs",children:[e.jsx("div",{className:"text-2xs text-muted-foreground",children:"Contagem"}),e.jsx("div",{className:"font-semibold",children:O?O.text:"-"})]}),e.jsxs("div",{className:"p-3 bg-black/30 rounded text-xs",children:[e.jsx("div",{className:"text-2xs text-muted-foreground",children:"Pilotos"}),e.jsxs("div",{className:"font-semibold",children:[s.participants.length,"/",x(s.maxParticipants)]})]}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsx(i,{size:"lg",onClick:X,disabled:v||y,children:v?"âœ“ Inscrito":y?"Inscrevendo...":"ðŸ Inscrever-se"})})]})]})})]})}),e.jsx("main",{className:"container py-8",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(j,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center justify-between w-full",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"})," Pilotos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-muted/20 rounded px-2 py-1",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),e.jsx("input",{value:w,onChange:t=>H(t.target.value),placeholder:"Buscar piloto",className:"bg-transparent outline-none text-sm w-48"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>G(u==="name"?"points":"name"),className:"text-sm px-2 py-1 rounded bg-muted/20",children:["Ordenar: ",u]}),e.jsxs("div",{className:"ml-2 flex items-center gap-1",children:[e.jsx("button",{onClick:()=>$("grid"),className:`p-2 ${k==="grid"?"bg-primary text-primary-foreground rounded":""}`,children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>$("list"),className:`p-2 ${k==="list"?"bg-primary text-primary-foreground rounded":""}`,children:e.jsx(he,{className:"h-4 w-4"})})]})]})]})]})}),e.jsx(f,{children:P.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-muted-foreground",children:"Nenhum piloto corresponde Ã  pesquisa"}):k==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map((t,a)=>e.jsx("div",{className:"p-4 rounded-lg border hover:shadow-lg transition bg-card",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{className:"h-12 w-12",children:[e.jsx(E,{src:t.avatar||void 0}),e.jsx(I,{children:t.displayName.substring(0,2).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.displayName}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.team})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:t.stats.points}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"pts"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(i,{size:"sm",onClick:()=>S(t),children:"Detalhes"}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(t.username),alert("Username copiado")},children:"Copiar"})]})]})]})},t.username))}):e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left",children:"Pos"}),e.jsx("th",{className:"p-3 text-left",children:"Piloto"}),e.jsx("th",{className:"p-3 text-center",children:"Pts"}),e.jsx("th",{className:"p-3 text-left",children:"Equipe"}),e.jsx("th",{className:"p-3 text-left",children:"InscriÃ§Ã£o"})]})}),e.jsx("tbody",{children:P.map((t,a)=>e.jsxs("tr",{className:"border-b hover:bg-muted/20 transition-colors",children:[e.jsx("td",{className:"p-3 font-bold",children:a+1}),e.jsxs("td",{className:"p-3 flex items-center gap-2",children:[e.jsxs(A,{className:"h-8 w-8",children:[e.jsx(E,{src:t.avatar||void 0}),e.jsx(I,{children:t.displayName.substring(0,1)})]}),e.jsx("span",{children:t.displayName})]}),e.jsx("td",{className:"p-3 text-center font-semibold",children:t.stats.points}),e.jsx("td",{className:"p-3",children:t.team}),e.jsx("td",{className:"p-3 text-xs text-muted-foreground",children:new Date(t.registeredAt).toLocaleDateString("pt-BR")})]},t.username))})]})})})]}),e.jsxs(j,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center justify-between",children:["Sistema de Corrida ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"Controles & Telemetria"})]})}),e.jsxs(f,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Servidor"}),e.jsxs("div",{className:"font-semibold",children:[s.serverIp||"NÃ£o configurado",":",s.serverPort||"-"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"UDP"}),e.jsx("div",{className:"font-semibold",children:s.udpEnabled?"Ativado":"Desativado"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsxs(i,{onClick:Q,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Iniciar UDP"]}),e.jsx(i,{variant:"outline",onClick:()=>J(!q),children:q?"Desativar Telemetria":"Ativar Telemetria"}),e.jsxs(i,{variant:"ghost",onClick:()=>alert("Assistir transmissÃ£o (futura)"),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Assistir"]})]}),e.jsx(F,{className:"my-4"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"RecomendaÃ§Ãµes de combustÃ­vel"}),e.jsxs("div",{className:"font-semibold",children:[x(s.fuelRecommendation),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:"Notas"}),e.jsx("div",{className:"text-sm",children:s.requirement||"Nenhuma observaÃ§Ã£o"})]})]})]}),e.jsxs("aside",{className:"space-y-6",children:[e.jsxs(j,{className:"sticky top-20",children:[e.jsx(p,{children:e.jsx(g,{children:"Resumo"})}),e.jsxs(f,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Data"}),e.jsx("div",{className:"font-semibold",children:z(s.date,s.time)}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:"Voltas / DuraÃ§Ã£o"}),e.jsxs("div",{className:"font-semibold",children:[x(s.laps)," / ",x(s.duration)]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:"Categoria"}),e.jsx("div",{className:"font-semibold",children:s.category||"-"}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:"PrÃªmio"}),e.jsx("div",{className:"font-semibold",children:s.prize||"-"})]}),e.jsx(F,{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i,{onClick:V,children:"Exportar Lista"}),e.jsx(i,{variant:"outline",onClick:()=>navigator.clipboard.writeText(window.location.href),children:"Copiar Link"})]})]})]}),e.jsxs(j,{children:[e.jsx(p,{children:e.jsx(g,{children:"Clima"})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Pista"}),e.jsxs("div",{className:"font-semibold",children:[x(s.trackTemp),"Â°C"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ar"}),e.jsxs("div",{className:"font-semibold",children:[x(s.airTemp),"Â°C"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Vento"}),e.jsxs("div",{className:"font-semibold",children:[x(s.windSpeed)," km/h"]})]})]})})]}),s.requirement&&e.jsxs(j,{className:"border-yellow-400/30 bg-yellow-50/5",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-yellow-500"}),"Requisitos"]})}),e.jsx(f,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:s.requirement})})]})]})]})}),e.jsx(R,{}),e.jsx(te,{open:!!n,onOpenChange:t=>{t||S(null)},children:e.jsx(ae,{children:n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(A,{className:"h-16 w-16",children:[e.jsx(E,{src:n.avatar||void 0}),e.jsx(I,{children:n.displayName.substring(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:n.displayName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.username})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsxs("div",{className:"font-semibold text-lg",children:[n.stats.points," pts"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.stats.wins," vitÃ³rias â€¢ ",n.stats.podiums," pÃ³dios"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Conquistas"}),e.jsx("div",{className:"flex gap-2 mt-2",children:n.achievements&&n.achievements.length>0?n.achievements.map((t,a)=>e.jsx("div",{className:"p-2 bg-muted/10 rounded text-sm",children:t.name||"Conquista"},a)):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Nenhuma conquista"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{onClick:()=>{navigator.clipboard.writeText(n.username),alert("Username copiado")},children:"Copiar Username"}),e.jsx(i,{variant:"outline",onClick:()=>S(null),children:"Fechar"})]})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(T,{}),e.jsxs("div",{className:"container py-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Corrida nÃ£o encontrada"}),e.jsxs(i,{onClick:()=>o("/races"),className:"mt-4",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Voltar"]})]}),e.jsx(R,{})]})};export{Ie as default};
